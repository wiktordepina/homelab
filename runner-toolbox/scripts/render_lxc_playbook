#!/usr/bin/env python3

import sys, yaml

vmid = sys.argv[1]

lcx_conf_path = f'./config/lxc/{vmid}.yaml'
with open(lcx_conf_path) as conf_file:
  lxc_conf = yaml.safe_load(conf_file)

lxc_ip = lxc_conf['terraform']['ip_address'].split('/')[0]
ansible_roles = lxc_conf['ansible'].get('roles')
ansible_tasks = lxc_conf['ansible'].get('tasks')

playbook = {
  "name": f'LXC {vmid}',
  "hosts": lxc_ip
}

if ansible_roles:
  playbook.update({"roles": ansible_roles})

if ansible_tasks:
  playbook.update({"tasks": ansible_tasks})

print(yaml.dump([playbook]))
